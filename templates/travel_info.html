{% extends "base.html" %}
{% load static %}
{% load markdownify %}

{% block content %}

<style>
  body {
    background-color: #f7f8fa;
  }
  .chat-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 60px 0;
    min-height: 100vh;
  }
  .chat-container {
    width: 100%;
    max-width: 700px;
    background-color: #fff;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    height: 85vh;
    margin-top: 100px !important;
  }
  .message-area {
    overflow-y: auto;
    flex-grow: 1;
    padding: 10px;
    border: 1px solid #dee2e6;
    border-radius: 10px;
    margin-bottom: 20px;
    background-color: #fdfdfd;
  }
  .message-block {
    margin-bottom: 15px;
  }
  .user-message .bubble {
    background: #0d6efd;
    color: white;
    padding: 12px 16px;
    border-radius: 20px 20px 0 20px;
    margin-left: auto;
    max-width: 80%;
  }
  .ai-message .bubble {
    background: #f1f3f5;
    padding: 14px 18px;
    border-radius: 20px 20px 20px 0;
    color: #212529;
    max-width: 95%;
  }
  .chat-footer form {
    display: flex;
    gap: 10px;
  }
  .chat-footer input[type="text"] {
    flex: 1;
    padding: 10px 15px;
    border-radius: 25px;
    border: 1px solid #ccc;
    outline: none;
  }
  .chat-footer button {
    border-radius: 25px;
    padding: 10px 20px;
    background-color: #0d6efd;
    color: white;
    border: none;
  }
  .clear-chat {
    text-align: right;
    margin-bottom: 10px;
  }


.ai-message a {
  display: inline-block;
  padding: 6px 12px;
  margin: 4px 6px 4px 0;
  background-color: #e0f0ff;
  color: #0d6efd;
  border-radius: 20px;
  font-size: 14px;
  text-decoration: none;
  transition: background-color 0.2s;
}

.ai-message a:hover {
  background-color: #cfe4ff;
}

.verified-badge {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 18px;
  height: 18px;
  margin-left: 6px;
  background-color: #0d6efd;
  color: white;
  font-size: 12px;
  border-radius: 50%;
  font-weight: bold;
}


</style>

<div class="chat-wrapper">
  <div class="chat-container">

    <div class="clear-chat">
      <form method="POST" action="{% url 'clear_chat' %}">
        {% csrf_token %}
        <button class="btn btn-sm btn-outline-danger">Clear Chat</button>
      </form>
    </div>

    <div class="message-area">
      {% for chat in chat_history %}
        <div class="message-block {% if chat.role == 'user' %}user-message{% else %}ai-message{% endif %}">
          <div class="bubble">
            {% if chat.role == 'user' %}
              {{ chat.content|linebreaksbr }}
            {% else %}
              {{ chat.content|markdownify|safe }}
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="chat-footer">
      <form method="POST">
        {% csrf_token %}
        <input type="text" name="query" placeholder="Type your message..." required>
        <button type="submit">Send</button>
      </form>
    </div>

  </div>
</div>

<script>
  const messageArea = document.querySelector(".message-area");
  messageArea.scrollTop = messageArea.scrollHeight;
</script>

{% endblock %}
